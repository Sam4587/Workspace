# 项目规范文件 (.trae.md)

> 本文件是 TrendRadar 热点内容监控与AI内容生成系统的核心规范文档。
> 所有代理在执行任务前必须先读取并理解本文件内容，并在整个任务执行过程中严格遵循其中规定的所有项目规范和约束条件。

---

## 1. 项目概述

- **项目名称**: TrendRadar
- **项目类型**: 热点内容监控与AI内容生成系统
- **技术栈**: React 18 + Vite 5 + TypeScript + Tailwind CSS + Node.js/Express
- **包管理器**: npm

---

## 2. 代码风格规范

### 2.1 缩进与格式

- **缩进**: 使用 2 空格缩进
- **行宽**: 每行不超过 100 字符
- **引号**: 优先使用单引号，JSX 中使用双引号
- **分号**: 不强制使用分号，保持文件内一致性
- **尾逗号**: 多行时添加尾逗号

### 2.2 命名约定

| 类型 | 命名规则 | 示例 |
|------|----------|------|
| 文件名 | 小写字母 + 连字符 | `user-service.ts`, `api-client.ts` |
| 组件名 | PascalCase | `UserProfile.tsx`, `NavigationBar.tsx` |
| 函数名 | camelCase | `fetchUserData()`, `calculateTotal()` |
| 常量 | UPPER_SNAKE_CASE | `MAX_RETRY_COUNT`, `API_BASE_URL` |
| 接口/类型 | PascalCase | `interface User`, `type ApiResponse` |
| 私有属性 | 下划线前缀 | `_privateMethod()`, `_internalState` |
| 事件处理函数 | handle + 动作 | `handleClick()`, `handleSubmit()` |
| 布尔变量 | is/has/can 前缀 | `isLoading`, `hasError`, `canEdit` |

### 2.3 注释要求

```typescript
/**
 * 函数说明 - 简要描述函数功能
 * @param paramName - 参数说明
 * @returns 返回值说明
 */
function functionName(paramName: string): ReturnType {
  // 实现逻辑
}

// TODO: 待办事项
// FIXME: 需要修复的问题
// NOTE: 重要说明
```

---

## 3. 框架特定约定

### 3.1 React 组件规范

```tsx
// 组件文件结构
import { useState, useEffect } from 'react';

interface Props {
  title: string;
  onSubmit?: (data: FormData) => void;
}

export function ComponentName({ title, onSubmit }: Props) {
  // 1. Hooks 声明
  const [state, setState] = useState<string>('');
  
  // 2. 副作用
  useEffect(() => {
    // effect logic
  }, [dependency]);
  
  // 3. 事件处理函数
  const handleClick = () => {
    // handler logic
  };
  
  // 4. 渲染逻辑
  return (
    <div className="component-wrapper">
      {/* JSX content */}
    </div>
  );
}
```

### 3.2 TypeScript 规范

```typescript
// 类型定义优先使用 interface
interface User {
  id: string;
  name: string;
  email: string;
}

// 复杂类型使用 type
type ApiResponse<T> = {
  data: T;
  status: number;
  message: string;
};

// 避免使用 any，使用 unknown 代替
function processValue(value: unknown): string {
  if (typeof value === 'string') {
    return value;
  }
  throw new Error('Invalid value type');
}
```

---

## 4. 文件大小限制

| 文件类型 | 建议上限 | 硬性上限 |
|----------|----------|----------|
| React 组件 | 200 行 | 400 行 |
| 工具函数文件 | 300 行 | 500 行 |
| API 路由文件 | 200 行 | 400 行 |
| 样式文件 | 300 行 | 500 行 |
| 测试文件 | 400 行 | 800 行 |

### 4.1 资源文件限制

| 资源类型 | 限制 |
|----------|------|
| 图片 (PNG/JPG) | 500KB |
| 图片 (WebP) | 300KB |
| SVG 图标 | 50KB |
| JavaScript Bundle | 500KB |
| CSS Bundle | 100KB |

---

## 5. 测试要求

### 5.1 覆盖率标准

| 指标 | 最低要求 | 目标值 |
|------|----------|--------|
| 语句覆盖率 | 70% | 80% |
| 分支覆盖率 | 60% | 75% |
| 函数覆盖率 | 70% | 85% |
| 行覆盖率 | 70% | 80% |

### 5.2 测试类型要求

- **单元测试**: 测试单个函数/组件
- **集成测试**: 测试 API 端点
- **E2E 测试**: 测试关键用户流程

---

## 6. 安全策略

### 6.1 数据验证规则

```typescript
import { z } from 'zod';

const UserSchema = z.object({
  email: z.string().email('无效的邮箱格式'),
  password: z.string()
    .min(8, '密码至少8个字符')
    .regex(/[A-Z]/, '密码必须包含大写字母')
    .regex(/[0-9]/, '密码必须包含数字'),
  name: z.string().min(2).max(50).optional(),
});
```

### 6.2 敏感信息处理规范

```typescript
// 禁止硬编码敏感信息
// 错误示例
const apiKey = 'sk-abc123';  // 绝对禁止

// 正确示例
const apiKey = process.env.API_KEY;
```

### 6.3 安全检查清单

- [ ] 没有硬编码的密钥
- [ ] 所有用户输入都经过验证
- [ ] 防止 SQL 注入
- [ ] 防止 XSS
- [ ] 已启用 CSRF 保护
- [ ] 所有端点都实施速率限制

---

## 7. 版本控制规范

### 7.1 分支命名规则

| 分支类型 | 命名格式 | 示例 |
|----------|----------|------|
| 主分支 | main | main |
| 功能分支 | feature/描述 | feature/user-authentication |
| 修复分支 | fix/描述 | fix/login-validation |
| 发布分支 | release/版本号 | release/1.2.0 |
| 热修复分支 | hotfix/描述 | hotfix/security-patch |

### 7.2 提交信息格式

```
<type>(<scope>): <description>

类型: feat, fix, refactor, docs, test, chore, perf, ci, style
```

---

## 8. 文档标准

### 8.1 README 模板

```markdown
# 项目名称

简短描述项目功能

## 快速开始

### 安装
npm install

### 开发
npm run dev

### 构建
npm run build
```

---

## 附录 A：规范文件位置关系

### A.1 文件组织结构

```
项目根目录/
├── .trae.md                    # 本文件 - 项目规范总入口
├── .claude/                    # Claude Code / Trae IDE 配置目录
│   ├── agents/                 # AI 代理配置
│   ├── skills/                 # 技能配置
│   ├── rules/                  # 规则文件
│   └── templates/              # 模板文件
└── sync-specs.ps1              # 规范同步脚本
```

### A.2 代理与规范的关系

```
用户请求
    │
    ▼
智能调度员 (smart-dispatcher)
    │
    ├── 读取 .trae.md 获取项目规范
    │
    └── 分发到专业代理
            │
            └── 各代理读取 .trae.md → 执行特定任务
```

---

## 附录 B：规范维护指南

### B.1 更新规范的流程

1. 确定更新范围
2. 更新主规范文件
3. 通知相关代理

### B.2 规范同步到新项目

```powershell
# 基本用法
.\sync-specs.ps1

# 同步到指定项目
.\sync-specs.ps1 -TargetPath "D:\Projects\NewProject"

# 强制覆盖并备份
.\sync-specs.ps1 -Force -Backup

# 预览操作
.\sync-specs.ps1 -DryRun
```

---

**最后更新**: 2026-02-21
**维护者**: TrendRadar 开发团队
**规范版本**: 1.0.0
