# 内容生成

## 概述

内容生成是 AI 内容创作系统的核心功能，通过集成多个 AI 模型（OpenAI、百度 AI、讯飞 AI），根据用户选择的热点话题和配置参数，自动生成高质量的内容。系统支持多种内容类型（长文章、微头条、视频脚本、音频脚本），并提供质量评估和优化建议。

## 内容类型

### 1. 长文章 (article)

**特点**:
- 字数: 1000-3000 字
- 结构: 包含引言、正文、结论
- 风格: 专业、深度分析
- 适用: 知识分享、观点表达

**模板结构**:
```
标题：吸引人的标题
引言：简述背景和重要性
正文：
  - 观点一 + 论据
  - 观点二 + 论据
  - 观点三 + 论据
结论：总结观点，提出建议
```

### 2. 微头条 (micro)

**特点**:
- 字数: 200-500 字
- 结构: 简洁明了，突出重点
- 风格: 轻松、口语化
- 适用: 热点评论、快速分享

**模板结构**:
```
标题：简洁有力
正文：
  - 抛出观点
  - 简单论证
  - 引导互动
```

### 3. 视频脚本 (video)

**特点**:
- 时长: 3-10 分钟
- 结构: 包含画面描述、台词、字幕
- 风格: 生动、有节奏感
- 适用: 短视频、教程视频

**模板结构**:
```
标题：视频标题
开场：
  [画面]：描述
  [台词]：内容
  [时长]：秒数
正文：
  - 场景一：画面+台词
  - 场景二：画面+台词
  - ...
结尾：
  [画面]：描述
  [台词]：总结
```

### 4. 音频脚本 (audio)

**特点**:
- 时长: 5-15 分钟
- 结构: 包含背景音乐建议、音效提示
- 风格: 娓娓道来、情感丰富
- 适用: 播客、有声书

**模板结构**:
```
标题：音频标题
开场：
  [背景音乐]：轻快/舒缓
  [台词]：欢迎语
正文：
  - 段落一：台词+音效
  - 段落二：台词+音效
  - ...
结尾：
  [背景音乐]：渐弱
  [台词]：结束语
```

## 生成参数

### 必填参数

| 参数 | 类型 | 说明 |
|------|------|------|
| type | String | 内容类型：article/micro/video/audio |
| title | String | 内容标题 |
| topic | String | 热点话题 |

### 可选参数

| 参数 | 类型 | 说明 | 选项 |
|------|------|------|------|
| keywords | String | 关键词，逗号分隔 | 任意 |
| targetAudience | String | 目标受众 | "普通读者"、"专业人士"、"学生"等 |
| tone | String | 内容风格 | professional/casual/emotional/humorous |
| length | String | 内容长度 | short/medium/long |
| includeData | Boolean | 是否包含数据 | true/false |
| includeCase | Boolean | 是否包含案例 | true/false |
| includeExpert | Boolean | 是否包含专家观点 | true/false |
| hotTopicId | String | 关联的热点话题 ID | ObjectId |

## AI 模型集成

### 1. OpenAI

**模型**: GPT-3.5-turbo / GPT-4

**优势**:
- 生成质量高
- 理解能力强
- 适用场景广

**配置**:
```javascript
const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY
});
```

**调用示例**:
```javascript
const response = await openai.chat.completions.create({
  model: 'gpt-3.5-turbo',
  messages: [
    {
      role: 'system',
      content: '你是一个专业的今日头条内容创作者...'
    },
    {
      role: 'user',
      content: prompt
    }
  ],
  max_tokens: 2000,
  temperature: 0.7
});
```

### 2. 百度 AI

**模型**: 文心一言

**优势**:
- 中文理解强
- 价格相对低
- 国内访问稳定

**配置**:
```javascript
const token = await getBaiduToken();
const response = await axios.post(
  'https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/completions',
  { messages, max_output_tokens: 2000 },
  { params: { access_token: token } }
);
```

### 3. 讯飞 AI

**模型**: 星火认知大模型

**优势**:
- 中文能力强
- 响应速度快
- 成本较低

**配置**:
```javascript
const response = await axios.post(
  'https://spark-api-open.xfyun.cn/v1/chat/completions',
  {
    model: 'general',
    messages,
    max_tokens: 2000,
    temperature: 0.7
  },
  {
    headers: {
      'Authorization': `Bearer ${apiKey}`,
      'Content-Type': 'application/json'
    }
  }
);
```

### 模型切换策略

系统采用智能模型切换策略：

```
1. 优先使用 OpenAI
   ↓
   失败？
   ↓
2. 切换到百度 AI
   ↓
   失败？
   ↓
3. 切换到讯飞 AI
   ↓
   全部失败 → 抛出错误
```

## 提示词工程

### 系统提示词 (System Prompt)

```javascript
const systemPrompt = `你是一个专业的今日头条内容创作者，擅长撰写高质量的文章、微头条、视频脚本等。

创作原则：
1. 内容要真实、有价值，避免虚假信息
2. 语言要通俗易懂，适合大众阅读
3. 观点要明确，逻辑要清晰
4. 要有吸引力，能够引起读者共鸣
5. 遵守平台规范，不发布违规内容`;
```

### 用户提示词 (User Prompt)

根据不同内容类型，生成不同的提示词：

**长文章**:
```
请根据以下信息生成一篇长文章：

话题：{topic}
标题：{title}
关键词：{keywords}
目标受众：{targetAudience}
内容风格：{tone}
长度：{length}
是否包含数据：{includeData}
是否包含案例：{includeCase}
是否包含专家观点：{includeExpert}

要求：
- 字数控制在 1000-3000 字
- 包含引言、正文、结论三个部分
- 观点明确，论据充分
- 语言流畅，结构清晰
```

**微头条**:
```
请根据以下信息生成一篇微头条：

话题：{topic}
标题：{title}
关键词：{keywords}
内容风格：{tone}

要求：
- 字数控制在 200-500 字
- 简洁明了，突出重点
- 语言轻松，口语化
- 引导用户互动
```

## 质量评估

### 评估维度

| 维度 | 权重 | 评估标准 |
|------|------|----------|
| 内容完整性 | 30% | 结构完整，包含必要元素 |
| 语言流畅度 | 25% | 语言通顺，无语法错误 |
| 观点清晰度 | 20% | 观点明确，逻辑清晰 |
| 吸引力 | 15% | 标题和开头有吸引力 |
| 规范性 | 10% | 符合平台规范 |

### 评分算法

```javascript
function assessQuality(content, type) {
  let score = 0;

  // 内容完整性（30%）
  if (hasIntroduction(content)) score += 10;
  if (hasBody(content)) score += 10;
  if (hasConclusion(content)) score += 10;

  // 语言流畅度（25%）
  const readability = calculateReadability(content);
  score += readability * 0.25;

  // 观点清晰度（20%）
  if (hasClearViewpoint(content)) score += 10;
  if (hasLogicalFlow(content)) score += 10;

  // 吸引力（15%）
  if (hasCatchyTitle(content)) score += 5;
  if (hasEngagingIntro(content)) score += 5;

  // 规范性（10%）
  if (compliesWithRules(content)) score += 10;

  return Math.min(100, Math.max(0, score));
}
```

### 优化建议生成

根据质量评估结果，生成优化建议：

```javascript
function generateSuggestions(content, score) {
  const suggestions = [];

  if (score < 70) {
    suggestions.push('建议增加更多论据支撑观点');
    suggestions.push('可以添加数据或案例增强说服力');
  }

  if (!hasExamples(content)) {
    suggestions.push('建议添加具体案例');
  }

  if (!hasData(content)) {
    suggestions.push('建议添加数据支持');
  }

  if (!hasExpertQuotes(content)) {
    suggestions.push('建议引用专家观点');
  }

  return suggestions;
}
```

## 生成流程

```
用户选择热点话题
    ↓
填写生成参数
    ├── 选择内容类型
    ├── 输入标题
    ├── 添加关键词
    ├── 选择目标受众
    ├── 选择内容风格
    └── 配置其他选项
    ↓
构建提示词
    ├── 系统提示词
    └── 用户提示词
    ↓
调用 AI 模型
    ├── 优先 OpenAI
    ├── 失败则百度 AI
    └── 再失败则讯飞 AI
    ↓
解析生成结果
    ├── 提取内容文本
    ├── 记录使用量
    └── 保存模型信息
    ↓
质量评估
    ├── 计算质量分数
    ├── 生成优化建议
    └── 统计字数和阅读时间
    ↓
保存到数据库
    ├── 内容本体
    ├── 元数据
    ├── 评估结果
    └── 关联热点话题
    ↓
返回给前端
    ├── 内容预览
    ├── 质量分数
    └── 优化建议
```

## 数据模型

### Content Schema

```javascript
{
  _id: ObjectId,
  title: String,              // 标题
  content: String,             // 内容
  type: String,               // 类型：article/micro/video/audio
  hotTopicId: ObjectId,        // 关联的热点话题
  keywords: [String],          // 关键词
  wordCount: Number,           // 字数
  readingTime: Number,         // 阅读时间（分钟）
  quality: Number,             // 质量分数（0-100）
  suggestions: [String],       // 优化建议
  status: String,             // 状态：draft/review/approved/rejected/published
  author: String,            // 作者
  metadata: {
    targetAudience: String,   // 目标受众
    tone: String,           // 内容风格
    length: String,         // 内容长度
    includeData: Boolean,    // 是否包含数据
    includeCase: Boolean,    // 是否包含案例
    includeExpert: Boolean   // 是否包含专家观点
  },
  createdAt: Date,
  updatedAt: Date
}
```

## API 接口

### 生成内容

```
POST /api/content/generate
```

**请求体**:
```json
{
  "type": "article",
  "title": "人工智能在医疗领域的应用",
  "topic": "人工智能在医疗领域的应用",
  "keywords": "人工智能,医疗,AI",
  "targetAudience": "医疗从业者",
  "tone": "professional",
  "length": "medium",
  "includeData": true,
  "includeCase": false,
  "includeExpert": false,
  "hotTopicId": "60d5ec9f8b8c6d1e8c8d7e8a"
}
```

**响应**:
```json
{
  "success": true,
  "data": {
    "_id": "60d5ec9f8b8c6d1e8c8d7e8b",
    "title": "人工智能在医疗领域的应用",
    "content": "随着人工智能技术的快速发展...",
    "type": "article",
    "wordCount": 1200,
    "readingTime": 5,
    "quality": 85,
    "suggestions": ["可以增加具体案例"],
    "status": "draft"
  }
}
```

### 更新内容

```
PATCH /api/content/:id
```

### 删除内容

```
DELETE /api/content/:id
```

## 最佳实践

### 1. 选择合适的话题

选择适配度高、趋势上升的话题，更容易生成受欢迎的内容。

### 2. 优化提示词

根据内容类型调整提示词，突出重点要求，提高生成质量。

### 3. 多次生成对比

对于重要内容，可以多次生成，选择质量最高的版本。

### 4. 人工编辑优化

AI 生成的内容需要人工编辑，补充细节，调整语气。

### 5. 质量评估参考

参考质量评分和优化建议，有针对性地改进内容。

## 性能优化

### 1. 模型预热

系统启动时预热 AI 模型连接，减少首次调用延迟。

### 2. 结果缓存

相同的生成参数可以缓存结果，避免重复调用。

### 3. 并行生成

对于批量生成场景，可以并行调用 AI 模型。

### 4. 流式输出

对于长内容，使用流式输出提升用户体验。

## 错误处理

### 常见错误

| 错误类型 | 处理方式 |
|----------|----------|
| API Key 无效 | 提示用户检查配置 |
| 配额不足 | 提示用户升级计划 |
| 网络超时 | 自动重试 3 次 |
| 模型错误 | 切换到备用模型 |
| 生成失败 | 返回详细错误信息 |

### 重试策略

```javascript
async function generateWithRetry(prompt, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await generateContent(prompt);
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await sleep(1000 * (i + 1)); // 指数退避
    }
  }
}
```

## 扩展规划

### 短期

- [ ] 添加更多 AI 模型支持
- [ ] 优化提示词模板
- [ ] 改进质量评估算法

### 中期

- [ ] 支持自定义风格
- [ ] 实现内容个性化
- [ ] 添加历史版本管理

### 长期

- [ ] 构建内容风格模型
- [ ] 实现智能选题
- [ ] 支持多语言生成
