# 热点话题

## 概述

热点话题是 AI 内容创作系统的核心数据源，系统通过定时抓取各大平台（微博、今日头条、百度等）的热门话题，为用户提供内容创作的素材来源。每个热点话题都包含丰富的元数据，帮助用户快速了解话题热度、趋势和适配度。

## 数据模型

### HotTopic Schema

```javascript
{
  _id: ObjectId,              // 唯一标识
  title: String,               // 话题标题
  description: String,         // 话题描述
  category: String,           // 分类（科技、娱乐、财经等）
  heat: Number,              // 热度值（0-100）
  trend: String,             // 趋势（up/down/stable）
  source: String,            // 来源平台（微博热搜、今日头条等）
  sourceUrl: String,         // 来源链接
  keywords: [String],       // 关键词列表
  suitability: Number,        // 适配度评分（0-100）
  publishedAt: Date,        // 发布时间
  createdAt: Date,          // 创建时间
  updatedAt: Date           // 更新时间
}
```

## 抓取机制

### 数据源

系统目前支持以下数据源：

#### 1. 微博热搜

- **接口类型**: API
- **URL**: `https://weibo.com/ajax/side/hotSearch`
- **更新频率**: 每 30 分钟
- **抓取数量**: 前 20 条

**特点**:
- 实时性强
- 数据结构规范
- 包含热度排名

#### 2. 今日头条热点

- **接口类型**: 页面抓取
- **URL**: `https://www.toutiao.com/hot`
- **更新频率**: 每 30 分钟
- **抓取数量**: 前 20 条

**特点**:
- 内容质量高
- 适合深度创作
- 包含热度值

#### 3. 百度热搜

- **接口类型**: 页面抓取
- **URL**: `https://top.baidu.com/board`
- **更新频率**: 每 30 分钟
- **抓取数量**: 前 20 条

**特点**:
- 覆盖面广
- 分类清晰
- 搜索趋势反映

### 抓取流程

```
定时任务触发 (cron: */30 * * * *)
    ↓
遍历所有数据源
    ↓
并行抓取数据
    ├── 微博热搜 API 调用
    ├── 今日头条 HTML 解析
    └── 百度热搜 HTML 解析
    ↓
数据标准化
    ├── 统一字段格式
    ├── 提取关键词
    ├── 识别分类
    └── 计算适配度
    ↓
去重处理
    ├── 根据标题去重
    └── 根据来源去重
    ↓
批量更新到 MongoDB
    ├── 使用 findOneAndUpdate
    └── upsert: true (不存在则创建)
    ↓
更新 Redis 缓存
    ├── 设置 TTL: 30 分钟
    └── 缓存热门话题列表
```

## 分类系统

### 分类规则

系统通过关键词匹配自动将话题分类到以下类别：

| 分类 | 关键词示例 |
|------|-----------|
| 科技 | AI、人工智能、科技、互联网、手机、数码 |
| 娱乐 | 电影、明星、综艺、音乐、电视剧、娱乐 |
| 财经 | 股市、经济、金融、投资、房价、财经 |
| 体育 | 足球、篮球、奥运、体育、运动员 |
| 社会 | 社会、民生、政策、教育、医疗 |
| 国际 | 国际、外交、战争、政治、国家 |
| 其他 | 无法归类的其他话题 |

### 分类算法

```javascript
function categorizeTopic(title) {
  const categories = {
    '娱乐': ['电影', '明星', '综艺', '音乐', '电视剧', '娱乐'],
    '科技': ['AI', '人工智能', '科技', '互联网', '手机', '数码'],
    '财经': ['股市', '经济', '金融', '投资', '房价', '财经'],
    '体育': ['足球', '篮球', '奥运', '体育', '运动员'],
    '社会': ['社会', '民生', '政策', '教育', '医疗'],
    '国际': ['国际', '外交', '战争', '政治', '国家']
  };

  for (const [category, keywords] of Object.entries(categories)) {
    if (keywords.some(keyword => title.includes(keyword))) {
      return category;
    }
  }

  return '其他';
}
```

## 适配度评分

### 评分标准

适配度评分（0-100）用于评估话题是否适合创作，综合考虑多个因素：

| 因素 | 权重 | 说明 |
|------|------|------|
| 标题长度 | 20% | 10-50 字为最佳长度 |
| 标题特征 | 30% | 包含问号、感叹号、最新、突发等词 |
| 关键词质量 | 20% | 关键词的稀缺性和相关性 |
| 热度趋势 | 15% | 热度上升趋势 |
| 分类适配 | 15% | 分类与用户偏好匹配度 |

### 评分算法

```javascript
function calculateSuitability(title) {
  let score = 50; // 基础分

  // 标题长度评分
  if (title.length > 10 && title.length < 50) score += 20;
  else if (title.length >= 50) score -= 10;
  else if (title.length <= 10) score -= 15;

  // 标题特征评分
  if (title.includes('？') || title.includes('!')) score += 10;
  if (title.includes('最新') || title.includes('突发')) score += 15;
  if (title.includes('揭秘') || title.includes('真相')) score += 10;

  return Math.min(100, Math.max(0, score));
}
```

### 评分等级

- **90-100 分**: 极佳，强烈推荐创作
- **75-89 分**: 良好，适合创作
- **60-74 分**: 一般，可以考虑
- **低于 60 分**: 较差，不建议创作

## 关键词提取

### 提取规则

1. **分词**: 使用正则表达式按标点符号分割
2. **过滤**: 移除常见停用词（的、了、在、是等）
3. **筛选**: 保留长度大于 1 的词
4. **去重**: 移除重复关键词
5. **限制**: 最多返回 5 个关键词

### 停用词列表

```
['的', '了', '在', '是', '我', '有', '和', '就', '不', '人', '都', '一',
 '一个', '上', '也', '很', '到', '说', '要', '去', '你', '会', '着',
 '没有', '看', '好', '自己', '这']
```

## 趋势分析

### 趋势类型

| 趋势 | 说明 | 判断标准 |
|------|------|----------|
| up | 上升 | 排名在前 5 位 |
| stable | 稳定 | 排名在 5-15 位 |
| down | 下降 | 排名在 15 位之后 |

### 趋势计算

```javascript
function getTrend(index) {
  if (index < 5) return 'up';
  if (index > 15) return 'down';
  return 'stable';
}
```

## 数据缓存

### Redis 缓存策略

| 缓存键 | TTL | 用途 |
|--------|-----|------|
| `hot-topics:list` | 30 分钟 | 热点话题列表 |
| `hot-topics:{id}` | 1 小时 | 单个热点详情 |
| `hot-topics:category:{name}` | 30 分钟 | 分类热点列表 |

### 缓存更新

- **主动更新**: 定时任务每 30 分钟更新一次
- **被动更新**: 热点话题数据变更时更新
- **缓存失效**: TTL 到期自动失效

## API 接口

### 获取热点列表

```
GET /api/hot-topics
```

**查询参数**:
- `page`: 页码
- `limit`: 每页数量
- `category`: 分类筛选
- `search`: 搜索关键词
- `minHeat`: 最小热度
- `maxHeat`: 最大热度
- `sortBy`: 排序字段
- `sortOrder`: 排序方式

### 获取热点详情

```
GET /api/hot-topics/:id
```

### 更新热点数据

```
POST /api/hot-topics/update
```

## 使用场景

### 1. 热点浏览

用户可以浏览当前热门话题，查看话题热度、趋势和适配度，选择适合创作的话题。

### 2. 话题搜索

用户可以通过关键词搜索话题，快速找到感兴趣的内容。

### 3. 分类筛选

用户可以按分类筛选话题，专注于特定领域的内容创作。

### 4. 话题关联

生成内容时，可以关联热点话题，方便后续追踪和分析。

## 最佳实践

### 1. 选择适配度高的话题

优先选择适配度评分在 75 分以上的话题，这些话题更适合创作，更容易获得良好的表现。

### 2. 关注上升趋势

选择趋势为 "上升" 的话题，这些话题正在获得更多关注，创作后可能有更好的传播效果。

### 3. 结合个人领域

选择与自己擅长领域相关的话题，可以创作出更高质量的内容。

### 4. 多角度切入

同一个热点话题可以从不同角度切入，创作出有差异化的内容。

## 性能优化

### 1. 并行抓取

使用 `Promise.all` 并行抓取多个数据源，减少总耗时。

### 2. 批量更新

使用 MongoDB 的 `bulkWrite` 或 `findOneAndUpdate` 批量更新数据。

### 3. 缓存策略

使用 Redis 缓存热点数据，减少数据库查询。

### 4. 索引优化

在 `category`、`heat`、`createdAt` 等字段上建立索引，提升查询性能。

## 扩展规划

### 短期

- [ ] 添加更多数据源（知乎、B站、抖音等）
- [ ] 优化分类算法，提高准确率
- [ ] 添加话题相似度推荐

### 中期

- [ ] 实现话题趋势预测
- [ ] 添加话题生命周期管理
- [ ] 支持自定义话题源

### 长期

- [ ] 构建话题知识图谱
- [ ] 实现智能话题推荐
- [ ] 支持多语言话题抓取
