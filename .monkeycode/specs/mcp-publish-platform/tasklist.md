# 抖音和今日头条 MCP 发布工具实施计划

## 项目信息

- **项目名称**: mcp-publish-platform
- **功能**: 抖音和今日头条 MCP 发布工具
- **参考项目**: https://github.com/xpzouying/xiaohongshu-mcp
- **技术栈**: Go 1.21+ + Rod + HTTP/MCP 协议

## 实施任务

### 阶段 1：项目初始化和基础设施搭建

- [ ] 1.1 创建项目目录结构
  - [ ] 1.1.1 创建 Go 模块目录（cmd, internal, pkg）
  - [ ] 1.1.2 创建配置目录（config, docs, scripts）
  - [ ] 1.1.3 初始化 Go 模块（go mod init mcp-publish-platform）

- [ ] 1.2 添加项目依赖
  - [ ] 1.2.1 添加 Rod 浏览器自动化库（go get github.com/go-rod/rod）
  - [ ] 1.2.2 添加 Zap 日志库（go get go.uber.org/zap）
  - [ ] 1.2.3 添加标准 HTTP 库（net/http 已内置）
  - [ ] 1.2.4 添加 JSON 处理库（encoding/json 已内置）
  - [ ] 1.2.5 添加配置管理库（go get github.com/spf13/viper）

- [ ] 1.3 配置开发环境
  - [ ] 1.3.1 创建 .gitignore 文件
  - [ ] 1.3.2 创建 .editorconfig 文件
  - [ ] 1.3.3 创建 Makefile（编译、测试、清理）
  - [ ] 1.3.4 创建 go.work 文件（如果使用 Go workspace）

### 阶段 2：核心数据模型和接口定义

- [ ] 2.1 创建数据模型
  - [ ] 2.1.1 创建登录相关模型（LoginRequest, LoginResponse, Credentials）
  - [ ] 2.1.2 创建发布相关模型（PublishRequest, PublishResponse, Content）
  - [ ] 2.1.3 创建内容管理模型（Content, ContentDetail）
  - [ ] 2.1.4 创建互动相关模型（LikeRequest, CommentRequest）
  - [ ] 2.1.5 创建 MCP 协议模型（MCPRequest, MCPResponse, MCPTool）

- [ ] 2.2 创建平台抽象接口
  - [ ] 2.2.1 定义 Platform 接口（包含所有平台方法）
  - [ ] 2.2.2 定义 PlatformID 枚举（douyin, toutiao）
  - [ ] 2.2.3 定义平台配置结构（PlatformConfig）

### 阶段 3：共享模块实现

- [ ] 3.1 实现登录管理器
  - [ ] 3.1.1 创建 AuthManager 结构体和方法
  - [ ] 3.1.2 实现二维码登录流程（QRCodeLogin）
  - [ ] 3.1.3 实现登录状态轮询（pollLoginStatus）
  - [ ] 3.1.4 实现凭证提取（extractCredentials）
  - [ ] 3.1.5 添加日志记录

- [ ] 3.2 实现凭证存储
  - [ ] 3.2.1 创建 CredentialStorage 结构体
  - [ ] 3.2.2 实现凭证保存（Save）
  - [ ] 3.2.3 实现凭证加载（Load）
  - [ ] 3.2.4 实现凭证验证（Validate）
  - [ ] 3.2.5 实现凭证删除（Delete）

- [ ] 3.3 实现浏览器控制器
  - [ ] 3.3.1 创建 BrowserController 结构体
  - [ ] 3.3.2 实现浏览器初始化（InitBrowser）
  - [ ] 3.3.3 实现页面加载和等待
  - [ ] 3.3.4 实现元素定位（MustElement）
  - [ ] 3.3.5 实现模拟点击（SimulateClick）
  - [ ] 3.3.6 实现模拟输入（SimulateInput）
  - [ ] 3.3.7 实现图片上传（UploadImage）

- [ ] 3.4 实现反爬虫控制器
  - [ ] 3.4.1 创建 AntiBotController 结构体
  - [ ] 3.4.2 定义 User-Agent 池和屏幕尺寸池
  - [ ] 3.4.3 实现配置无头模式（ConfigureIncognito）
  - [ ] 3.4.4 实现随机 User-Agent 选择
  - [ ] 3.4.5 实现操作延迟（RandomDelay）
  - [ ] 3.4.6 实现操作间隔限制（OperationInterval）

- [ ] 3.5 实现日志和配置管理
  - [ ] 3.5.1 创建配置管理器（ConfigManager）
  - [ ] 3.5.2 实现配置文件加载（Load）
  - [ ] 3.5.3 实现配置文件保存（Save）
  - [ ] 3.5.4 实现热重载（Watch）
  - [ ] 3.5.5 初始化 Zap 日志器

### 阶段 4：平台服务实现

- [ ] 4.1 实现抖音服务
  - [ ] 4.1.1 创建 DouyinService 结构体
  - [ ] 4.1.2 实现抖音登录（Login）
  - [ ] 4.1.3 实现抖音图文发布（PublishImageText）
  - [ ] 4.1.4 实现抖音视频发布（PublishVideo）
  - [ ] 4.1.5 实现获取内容列表（GetContents）
  - [ ] 4.1.6 实现获取内容详情（GetContentDetail）
  - [ ] 4.1.7 实现点赞操作（Like）
  - [ ] 4.1.8 实现评论操作（Comment）

- [ ] 4.2 实现今日头条服务
  - [ ] 4.2.1 创建 ToutiaoService 结构体
  - [ ] 4.2.2 实现今日头条登录（Login）
  - [ ] 4.2.3 实现图文发布（PublishImageText）
  - [ ] 4.2.4 实现视频发布（PublishVideo）
  - [ ] 4.2.5 实现获取内容列表（GetContents）
  - [ ] 4.2.6 实现获取内容详情（GetContentDetail）
  - [ ] 4.2.7 实现收藏操作（Collect）

### 阶段 5：HTTP API 层实现

- [ ] 5.1 创建 HTTP 服务器
  - [ ] 5.1.1 创建 HTTPServer 结构体
  - [ ] 5.1.2 实现路由注册
  - [ ] 5.1.3 实现请求解析和验证
  - [ ] 5.1.4 实现响应格式化
  - [ ] 5.1.5 添加 CORS 支持

- [ ] 5.2 实现 API 处理器
  - [ ] 5.2.1 实现登录处理器（HandleLogin）
  - [ ] 5.2.2 实现发布处理器（HandlePublish）
  - [ ] 5.2.3 实现内容列表处理器（HandleGetContents）
  - [ ] 5.2.4 实现内容详情处理器（HandleGetContentDetail）
  - [ ] 5.2.5 实现互动操作处理器（HandleLike, HandleComment）
  - [ ] 5.2.6 实现状态查询处理器（HandleStatus）

### 阶段 6：MCP 协议层实现

- [ ] 6.1 实现 MCP 服务器
  - [ ] 6.1.1 创建 MCPServer 结构体
  - [ ] 6.1.2 实现连接处理（HandleConnect）
  - [ ] 6.1.3 实现初始化处理（HandleInitialize）
  - [ ] 6.1.4 实现工具列表处理（HandleTools）
  - [ ] 6.1.5 实现工具调用处理（HandleCall）

- [ ] 6.2 定义 MCP 工具
  - [ ] 6.2.1 创建工具定义文件（mcp_tools.go）
  - [ ] 6.2.2 定义抖音登录工具（douyin_login）
  - [ ] 6.2.3 定义抖音图文发布工具（douyin_publish_image_text）
  - [ ] 6.2.4 定义抖音视频发布工具（douyin_publish_video）
  - [ ] 6.2.5 定义抖音内容列表工具（douyin_get_contents）
  - [ ] 6.2.6 定义抖音内容详情工具（douyin_get_content_detail）
  - [ ] 6.2.7 定义抖音互动工具（douyin_like, douyin_comment）
  - [ ] 6.2.8 定义今日头条登录工具（toutiao_login）
  - [ ] 6.2.9 定义今日头条发布工具（toutiao_publish）
  - [ ] 6.2.10 定义今日头条内容列表工具（toutiao_get_contents）
  - [ ] 6.2.11 定义今日头条内容详情工具（toutiao_get_content_detail）

- [ ] 6.3 实现平台切换
  - [ ] 6.3.1 实现平台注册机制（RegisterPlatform）
  - [ ] 6.3.2 实现平台切换逻辑（SwitchPlatform）
  - [ ] 6.3.3 实现当前平台获取（GetCurrentPlatform）
  - [ ] 6.3.4 实现多平台并发控制

### 阶段 7：主程序和可执行文件

- [ ] 7.1 创建主程序入口
  - [ ] 7.1.1 创建 cmd/main.go 文件
  - [ ] 7.1.2 实现命令行参数解析（flag）
  - [ ] 7.1.3 实现 Graceful Shutdown
  - [ ] 7.1.4 添加信号处理（SIGTERM, SIGINT）

- [ ] 7.2 实现服务启动
  - [ ] 7.2.1 实现 HTTP 服务器启动
  - [ ] 7.2.2 实现 MCP 服务器启动
  - [ ] 7.2.3 实现健康检查接口
  - [ ] 7.2.4 实现优雅停机

- [ ] 7.3 构建可执行文件
  - [ ] 7.3.1 配置 Linux 编译目标（linux/amd64）
  - [ ] 7.3.2 配置 macOS 编译目标（darwin/amd64, darwin/arm64）
  - [ ] 7.3.3 配置 Windows 编译目标（windows/amd64）
  - [ ] 7.3.4 创建构建脚本（build.sh, build.bat）
  - [ ] 7.3.5 测试各平台可执行文件

- [ ] 7.4 创建配置文件模板
  - [ ] 7.4.1 创建 config/config.json（默认配置）
  - [ ] 7.4.2 创建 config/config.example.json（配置模板）
  - [ ] 7.4.3 定义所有配置项
  - [ ] 7.4.4 添加配置说明和注释

- [ ] 7.5 创建启动脚本
  - [ ] 7.5.1 创建 Linux/macOS 启动脚本（start.sh）
  - [ ] 7.5.2 创建 Windows 启动脚本（start.bat）
  - [ ] 7.5.3 实现依赖检查和安装提示
  - [ ] 7.5.4 添加环境变量支持

### 阶段 8：文档编写

- [ ] 8.1 编写 API 文档
  - [ ] 8.1.1 创建 docs/API.md 文件
  - [ ] 8.1.2 编写所有接口说明（方法、URL、参数、响应）
  - [ ] 8.1.3 添加请求和响应示例
  - [ ] 8.1.4 添加错误码说明

- [ ] 8.2 编写 MCP 协议文档
  - [ ] 8.2.1 创建 docs/MCP.md 文件
  - [ ] 8.2.2 编写连接说明
  - [ ] 8.2.3 编写工具列表说明
  - [ ] 8.2.4 编写工具调用示例
  - [ ] 8.2.5 添加平台切换说明

- [ ] 8.3 编写配置文档
  - [ ] 8.3.1 创建 docs/CONFIG.md 文件
  - [ ] 8.3.2 编写所有配置项说明
  - [ ] 8.3.3 添加配置示例
  - [ ] 8.3.4 添加安全配置建议

- [ ] 8.4 编写部署文档
  - [ ] 8.4.1 创建 docs/DEPLOYMENT.md 文件
  - [ ] 8.4.2 编写环境要求
  - [ ] 8.4.3 编写安装步骤
  - [ ] 8.4.4 编写启动和停止说明
  - [ ] 8.4.5 添加故障排查指南

- [ ] 8.5 编写 README
  - [ ] 8.5.1 创建 README.md 文件
  - [ ] 8.5.2 编写项目介绍
  - [ ] 8.5.3 编写快速开始指南
  - [ ] 8.5.4 添加功能特性说明
  - [ ] 8.5.5 添加联系方式和许可证

### 阶段 9：测试验证

- [ ] 9.1 单元测试
  - [ ] *9.1.1 为数据模型编写单元测试
    - [ ] *9.1.2 为凭证存储编写单元测试
    - [ ] *9.1.3 为平台接口编写单元测试
    - [ ] *9.1.4 为 HTTP API 编写单元测试
  - [ ] *9.1.5 为 MCP 协议编写单元测试

- [ ] 9.2 集成测试
  - [ ] *9.2.1 测试抖音登录流程
  - [ ] *9.2.2 测试今日头条登录流程
  - [ ] *9.2.3 测试抖音图文发布
  - [ ] *9.2.4 测试抖音视频发布
  - [ ] *9.2.5 测试今日头条图文发布
  - [ ] *9.2.6 测试内容列表获取
  - [ ] *9.2.7 测试内容详情获取
  - [ ] *9.2.8 测试互动操作（点赞、评论）

- [ ] 9.3 平台兼容性测试
  - [ ] 9.3.1 测试抖音创作者平台兼容性
  - [ ] 9.3.2 测试今日头条后台兼容性
  - [ ] 9.3.3 测试不同浏览器环境兼容性
  - [ ] 9.3.4 测试不同网络环境兼容性
  - [ ] *9.3.5 记录并修复兼容性问题

- [ ] 9.4 集成测试
  - [ ] *9.4.1 测试与 Cherry Studio 集成
  - [ ] *9.4.2 测试与 AnythingLLM 集成
  - [ ] *9.4.3 测试 HTTP API 集成
  - [ ] *9.4.4 测试 MCP 协议兼容性
  - [ ] *9.4.5 验证数据格式和响应一致性

- [ ] 9.5 性能测试
  - [ ] 9.5.1 测试登录响应时间
  - [ ] 9.5.2 测试图文发布时间
  - [ ] 9.5.3 测试视频上传速度
  - [ ] 9.5.4 测试内存使用情况
  - [ ] 9.5.5 测试 CPU 使用情况
  - [ ] 9.5.6 记录性能基准并优化

- [ ] 9.6 稳定性测试
  - [ ] *9.6.1 长时间运行测试（24 小时）
  - [ ] *9.6.2 内存泄漏检测
  - [ ] *9.6.3 浏览器实例泄漏检测
  - [ ] *9.6.4 并发操作测试
  - [ ] *9.6.5 异常恢复测试
  - [ ] *9.6.6 记录日志并分析稳定性问题

### 阶段 10：打包和交付

- [ ] 10.1 交叉编译所有平台
  - [ ] 10.1.1 编译 Linux AMD64
  - [ ] 10.1.2 编译 Linux ARM64
  - [ ] 10.1.3 编译 macOS AMD64
  - [ ] 10.1.4 编译 macOS ARM64
  - [ ] 10.1.5 编译 Windows AMD64
  - [ ] 10.1.6 验证所有可执行文件可运行

- [ ] 10.2 创建发布包
  - [ ] 10.2.1 创建发布目录（dist/）
  - [ ] 10.2.2 复制所有平台的可执行文件
  - [ ] 10.2.3 复制配置文件模板
  - [ ] 10.2.4 复制所有文档文件
  - [ ] 10.2.5 创建版本说明文件（CHANGELOG.md）

- [ ] 10.3 最终验证
  - [ ] 10.3.1 在本地测试发布包
  - [ ] 10.3.2 在不同操作系统测试发布包
  - [ ] 10.3.3 验证所有功能正常工作
  - [ ] 10.3.4 确保所有文档完整准确
  - [ ] 10.3.5 生成测试报告

### 阶段 11：部署和验证

- [ ] 11.1 本地部署验证
  - [ ] 11.1.1 启动服务验证所有功能
  - [ ] 11.1.2 使用 Cherry Studio 连接测试
  - [ ] 11.1.3 使用 AnythingLLM 连接测试
  - [ ] 11.1.4 测试 HTTP API 接口
  - [ ] 11.1.5 验证配置加载和热重载

- [ ] 11.2 性能优化
  - [ ] 11.2.1 优化浏览器启动时间
  - [ ] 11.2.2 优化页面加载等待逻辑
  - [ ] 11.2.3 实现连接池复用
  - [ ] 11.2.4 优化日志输出性能
  - [ ] 11.2.5 优化凭证存储性能

- [ ] 11.3 安全加固
  - [ ] 11.3.1 实现凭证加密存储
  - [ ] 11.3.2 添加日志脱敏处理
  - [ ] 11.3.3 加强 API 请求验证
  - [ ] 11.3.4 添加访问控制（可选）
  - [ ] 11.3.5 实现安全审计日志

- [ ] 11.4 文档完善
  - [ ] 11.4.1 更新 README 添加部署说明
  - [ ] 11.4.2 添加故障排查指南
  - [ ] 11.4.3 添加常见问题解答
  - [ ] 11.4.4 添加贡献指南（如开源）
  - [ ] 11.4.5 确保所有文档准确完整

### 阶段 12：验收和交付

- [ ] 12.1 功能验收
  - [ ] 12.1.1 验证所有需求已实现
  - [ ] 12.1.2 对照需求文档检查功能完整性
  - [ ] 12.1.3 确认所有功能测试通过
  - [ ] 12.1.4 确认性能测试达标
  - [ ] 12.1.5 生成功能验收报告

- [ ] 12.2 文档验收
  - [ ] 12.2.1 验证 API 文档完整性
  - [ ] 12.2.2 验证 MCP 协议文档准确性
  - [ ] 12.2.3 验证配置文档清晰性
  - [ ] 12.2.4 验证部署文档可操作性
  - [ ] 12.2.5 生成文档验收报告

- [ ] 12.3 质量验收
  - [ ] 12.3.1 代码质量审查（代码规范、错误处理）
  - [ ] 12.3.2 性能质量审查（响应时间、资源使用）
  - [ ] 12.3.3 安全质量审查（凭证安全、通信安全）
  - [ ] 12.3.4 可维护性审查（代码结构、注释）
  - [ ] 12.3.5 生成质量验收报告

- [ ] 12.4 最终交付
  - [ ] 12.4.1 整理所有源代码文件
  - [ ] 12.4.2 整理所有文档文件
  - [ ] 12.4.3 整理所有可执行文件
  - [ ] 12.4.4 创建交付清单
  - [ ] 12.4.5 生成最终交付报告
  - [ ] 12.4.6 通知用户完成交付
