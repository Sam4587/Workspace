# 需求文档

## 引言

本文档描述了视频转录与智能创作功能，旨在将热点视频转化为可编辑的文本内容，并通过 AI 进行内容总结与二次创作，形成完整的视频内容生产工作流。该功能整合了视频下载、语音转录、AI 分析和多平台内容改写能力。

## 词汇表

- **转录引擎**: 将视频/音频中的语音转换为文本的服务组件
- **Whisper**: OpenAI 开源的语音识别模型，支持本地部署
- **阿里云ASR**: 阿里云提供的智能语音服务，作为转录备用引擎
- **热点视频链接**: 从热点监控系统中提取的视频 URL（抖音/快手等平台）
- **二次创作**: 基于原始视频内容生成新的内容形式（如小红书笔记、抖音脚本、头条文章）
- **yt-dlp**: 开源视频下载工具，支持多平台视频提取
- **去水印**: 移除视频平台添加的水印标识
- **LiteLLM**: 统一的 LLM 接口层，支持多种 AI 模型提供商
- **发布工具**: 现有的 CLI 工具，支持小红书、抖音、今日头条等平台的内容发布

## 需求

### 需求1: 视频链接识别与解析

**用户故事:** AS 内容运营者，我想要从热点监控中发现视频内容并提取可下载的链接，以便后续进行转录和内容创作

#### Acceptance Criteria

1. WHEN 用户提供抖音或快手视频链接，系统 SHALL 自动识别视频平台并解析出视频 ID
2. WHEN 系统识别到视频平台链接，系统 SHALL 获取视频元数据（标题、作者、时长、封面）
3. IF 链接无法解析或视频已删除，系统 SHALL 返回明确的错误信息并记录日志

### 需求2: 视频下载与存储

**用户故事:** AS 内容运营者，我想要将视频下载到本地存储，以便进行后续的转录处理

#### Acceptance Criteria

1. WHEN 用户确认下载视频，系统 SHALL 使用 yt-dlp 工具下载视频文件
2. WHEN 视频下载完成，系统 SHALL 将视频存储到指定的本地目录并生成唯一标识
3. IF 用户选择去水印选项，系统 SHALL 调用第三方去水印服务处理视频
4. IF 下载过程超时或失败，系统 SHALL 记录错误信息并支持重试操作

### 需求3: 本地视频上传

**用户故事:** AS 内容运营者，我想要上传本地视频文件进行转录，以便处理非热点来源的视频内容

#### Acceptance Criteria

1. WHEN 用户上传本地视频文件，系统 SHALL 验证文件格式（支持 MP4、MOV、AVI、MKV）
2. WHEN 文件上传成功，系统 SHALL 将文件存储到临时目录并生成视频记录
3. IF 文件大小超过限制（500MB），系统 SHALL 拒绝上传并提示用户压缩文件

### 需求4: 语音转录引擎

**用户故事:** AS 内容运营者，我想要将视频中的语音转换为文本，以便进行内容分析和二次创作

#### Acceptance Criteria

1. WHEN 用户提交转录任务，系统 SHALL 首先尝试使用本地 Whisper 模型进行转录
2. WHILE Whisper 转录过程中，系统 SHALL 显示处理进度和预计剩余时间
3. IF 本地 Whisper 转录失败或超时，系统 SHALL 自动切换到阿里云 ASR 备用引擎
4. WHEN 转录完成，系统 SHALL 返回结构化的转录结果，包含完整文本、时间分段和置信度

### 需求5: 转录结果管理

**用户故事:** AS 内容运营者，我想要查看和管理转录结果，以便了解视频内容并进行后续处理

#### Acceptance Criteria

1. WHEN 转录任务完成，系统 SHALL 将结果存储到数据库并关联原视频记录
2. WHEN 用户查看转录结果，系统 SHALL 展示完整文本和按时间分段的内容
3. IF 转录结果包含低置信度片段，系统 SHALL 高亮标记供用户审核
4. WHILE 用户编辑转录文本，系统 SHALL 自动保存修改内容

### 需求6: AI 内容总结

**用户故事:** AS 内容运营者，我想要 AI 自动分析视频内容并生成摘要，以便快速了解视频核心信息

#### Acceptance Criteria

1. WHEN 用户请求内容分析，系统 SHALL 使用 LiteLLM 服务调用 AI 模型处理转录文本
2. WHEN AI 分析完成，系统 SHALL 返回包含核心摘要、关键观点和金句的结构化结果
3. IF 转录文本长度超过模型限制，系统 SHALL 先进行文本分段处理再汇总

### 需求7: 小红书风格内容改写

**用户故事:** AS 内容运营者，我想要将视频内容改写为小红书风格的图文笔记，以便发布到小红书平台

#### Acceptance Criteria

1. WHEN 用户选择小红书改写，系统 SHALL 生成符合小红书平台规范的内容
2. WHEN 内容生成完成，系统 SHALL 确保标题不超过 20 字，正文不超过 1000 字
3. IF 用户要求添加表情符号，系统 SHALL 在合适位置插入风格化的 Emoji
4. WHEN 内容生成完成，系统 SHALL 自动生成 3-5 个话题标签

### 需求8: 抖音风格内容改写

**用户故事:** AS 内容运营者，我想要将视频内容改写为抖音短视频脚本，以便制作口播视频

#### Acceptance Criteria

1. WHEN 用户选择抖音改写，系统 SHALL 生成适合短视频口播的脚本内容
2. WHEN 脚本生成完成，系统 SHALL 包含开头钩子（前3秒）、主体内容和结尾引导
3. IF 用户要求指定时长，系统 SHALL 调整内容长度以匹配目标时长
4. WHEN 脚本生成完成，系统 SHALL 提供建议的视频时长

### 需求9: 今日头条风格内容改写

**用户故事:** AS 内容运营者，我想要将视频内容改写为今日头条文章，以便进行图文发布

#### Acceptance Criteria

1. WHEN 用户选择头条改写，系统 SHALL 生成专业的新闻风格文章
2. WHEN 文章生成完成，系统 SHALL 确保标题不超过 30 字，正文不超过 2000 字
3. IF 用户要求微头条版本，系统 SHALL 额外生成 300 字以内的精简版本
4. WHEN 文章生成完成，系统 SHALL 自动生成相关话题标签

### 需求10: 批量平台内容生成

**用户故事:** AS 内容运营者，我想要一次性生成多平台的内容变体，以便提高内容分发效率

#### Acceptance Criteria

1. WHEN 用户选择多平台生成，系统 SHALL 同时生成小红书、抖音、头条三种风格的内容
2. WHEN 批量生成完成，系统 SHALL 展示各平台内容的预览供用户选择
3. IF 某平台生成失败，系统 SHALL 继续处理其他平台并报告失败原因

### 需求11: 内容一键发布

**用户故事:** AS 内容运营者，我想要将生成的改写内容直接发布到目标平台，以便完成内容分发闭环

#### Acceptance Criteria

1. WHEN 用户确认发布内容，系统 SHALL 调用现有的发布工具执行发布操作
2. WHEN 发布任务提交，系统 SHALL 返回任务 ID 供用户追踪发布状态
3. IF 发布成功，系统 SHALL 返回平台内容链接并记录发布历史
4. IF 发布失败，系统 SHALL 显示错误信息并提供重试选项

### 需求12: 视频转录配置管理

**用户故事:** AS 系统管理员，我想要配置转录引擎的参数，以便根据实际需求调整系统行为

#### Acceptance Criteria

1. WHEN 管理员修改转录配置，系统 SHALL 支持 YAML 格式的配置文件管理
2. WHEN 配置变更保存，系统 SHALL 验证配置参数的有效性
3. IF 配置了 API 密钥等敏感信息，系统 SHALL 支持从环境变量读取

### 需求13: 转录任务队列

**用户故事:** AS 内容运营者，我想要批量提交转录任务并查看任务状态，以便高效管理多个视频的处理

#### Acceptance Criteria

1. WHEN 用户提交多个转录任务，系统 SHALL 将任务加入队列并分配唯一标识
2. WHILE 任务队列处理中，系统 SHALL 按先进先出顺序执行转录任务
3. WHEN 用户查询任务状态，系统 SHALL 返回当前状态（排队中、处理中、完成、失败）
4. IF 系统资源不足，系统 SHALL 暂停接收新任务并提示用户稍后重试
