# AI Content Flow 服务启动器测试方案

## 测试环境

- 操作系统: Windows 10/11
- Node.js: 18+
- 浏览器: 夸克/Edge/Chrome

---

## 测试用例

### 测试1: 基本启动功能

**步骤**:
1. 双击 `AI-Content-Flow-Start-Service.bat`
2. 观察控制台输出

**预期结果**:
- 显示 Node.js 版本
- 显示项目目录
- 显示"正在启动服务..."
- 后端服务启动成功 (PID: xxx)
- 前端服务启动成功 (PID: xxx)
- 服务就绪验证通过
- 浏览器自动打开 http://localhost:5174

---

### 测试2: 后台运行功能

**步骤**:
1. 启动服务后，关闭命令行窗口
2. 访问 http://localhost:5174
3. 访问 http://localhost:5001/api/hot-topics

**预期结果**:
- 关闭窗口后服务继续运行
- 前端页面正常访问
- 后端API正常响应

---

### 测试3: 端口占用处理

**步骤**:
1. 手动启动服务（在终端运行 `npm run dev`）
2. 再次双击 `AI-Content-Flow-Start-Service.bat`

**预期结果**:
- 脚本检测到端口被占用
- 自动终止占用进程
- 服务正常启动

---

### 测试4: 浏览器自动打开

**步骤**:
1. 确保夸克浏览器已安装
2. 启动服务

**预期结果**:
- 优先使用夸克浏览器打开
- 如果夸克未安装，使用 Edge 或 Chrome
- 如果都未安装，使用默认浏览器

---

### 测试5: 停止服务功能

**步骤**:
1. 双击 `AI-Content-Flow-Stop-Service.bat`
2. 观察控制台输出
3. 访问 http://localhost:5174

**预期结果**:
- 显示停止进程信息
- PID 文件已删除
- 端口已释放
- 页面无法访问

---

### 测试6: 日志记录功能

**步骤**:
1. 启动服务
2. 查看 `logs/start-service-YYYY-MM-DD.log`

**预期结果**:
- 日志文件存在
- 包含启动时间、PID、端口等信息
- 包含错误信息（如有）

---

### 测试7: 服务状态验证

**步骤**:
1. 启动服务
2. 观察服务就绪验证输出

**预期结果**:
- 显示"后端服务就绪: http://localhost:5001"
- 显示"前端服务就绪: http://localhost:5174"
- 如果服务未就绪，显示超时警告

---

### 测试8: 异常处理

**步骤**:
1. 修改端口配置为已占用端口
2. 启动服务

**预期结果**:
- 显示错误信息
- 退出码非零
- 日志记录错误详情

---

## 测试检查清单

| 测试项 | Windows 10 | Windows 11 |
|--------|------------|------------|
| 基本启动 | [ ] | [ ] |
| 后台运行 | [ ] | [ ] |
| 端口占用处理 | [ ] | [ ] |
| 浏览器自动打开 | [ ] | [ ] |
| 停止服务 | [ ] | [ ] |
| 日志记录 | [ ] | [ ] |
| 服务状态验证 | [ ] | [ ] |
| 异常处理 | [ ] | [ ] |

---

## 已知问题

1. **进程分离**: Windows 上使用 `detached: true` + `unref()` 实现进程分离
2. **端口检测**: 使用 HTTP 请求检测服务就绪，而非简单的端口监听
3. **浏览器优先级**: 夸克 > Edge > Chrome > 默认浏览器

---

**测试日期**: 2026-02-19  
**测试版本**: v2.0
