# 开发流程规范

> **重要**：每次开发前必须执行以下两个步骤，确保代码同步和服务正常。

---

## 开发前必做（每次必执行）

### 步骤一：拉取远程代码

```bash
git pull origin master
```

**目的**：确保本地代码与远程仓库同步，避免冲突。

### 步骤二：启动服务

```bash
# 终端1：启动后端
cd server && node simple-server.js

# 终端2：启动前端
npm run dev
```

**验证服务状态**：
```bash
# 后端健康检查
curl http://localhost:5000/api/health

# 前端访问
curl http://localhost:5174/
```

---

## 功能开发流程

### 流程图

```
┌─────────────────────────────────────────────────────────────────────┐
│                        功能开发完整流程                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────┐     ┌──────────────┐     ┌──────────────┐        │
│  │  1. 需求分析  │────▶│  2. 技术设计  │────▶│  3. 任务拆分  │        │
│  │ requirements │     │   design     │     │  tasklist    │        │
│  └──────────────┘     └──────────────┘     └──────────────┘        │
│         │                    │                    │                │
│         ▼                    ▼                    ▼                │
│  ┌──────────────────────────────────────────────────────────┐      │
│  │                    4. 编码实现                             │      │
│  │  - 按任务清单逐项完成                                       │      │
│  │  - 遵循验收标准                                             │      │
│  └──────────────────────────────────────────────────────────┘      │
│         │                                                           │
│         ▼                                                           │
│  ┌──────────────┐     ┌──────────────┐     ┌──────────────┐        │
│  │  5. 测试验证  │────▶│  6. 代码提交  │────▶│  7. 文档更新  │        │
│  └──────────────┘     └──────────────┘     └──────────────┘        │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 阶段一：需求分析

**输出文档**: `docs/specs/{feature-name}/requirements.md`

**核心要素**:
1. **用户故事**: `AS {角色}, I WANT {功能}, SO THAT {价值}`
2. **验收标准**: 使用 WHEN-THEN-SHALL 格式
3. **非功能需求**: 性能、兼容性、安全性

**快速模板**:
```markdown
# 需求文档

## 需求1: {功能标题}

**用户故事:** AS {角色}, I WANT {目标}, SO THAT {价值}

### 验收标准

1. WHEN {条件} THEN SHALL {行为}
2. IF {异常} THEN SHALL {处理}
```

### 阶段二：技术设计

**输出文档**: `docs/specs/{feature-name}/design.md`

**核心要素**:
1. **架构图**: 模块关系和数据流
2. **模块划分**: 文件路径、职责、接口
3. **API 设计**: 端点、请求、响应
4. **错误处理**: 异常场景和处理策略

**快速模板**:
```markdown
# 设计文档

## 模块划分

### 模块: {名称}
**文件**: `path/to/file.js`
**职责**: xxx
**接口**: xxx

## API 设计
POST /api/xxx
Request: { ... }
Response: { ... }
```

### 阶段三：任务拆分

**输出文档**: `docs/specs/{feature-name}/tasklist.md`

**核心要素**:
1. **分阶段**: 按模块或优先级划分
2. **任务粒度**: 每个任务 2-4 小时可完成
3. **验收标准**: 明确完成定义

**快速模板**:
```markdown
# 任务清单

## 第一阶段：基础功能

- [ ] **任务1**: 描述
  - 验收: xxx
- [ ] **任务2**: 描述
  - 验收: xxx
```

### 阶段四：编码实现

**执行要点**:
1. 按任务清单顺序开发
2. 每完成一个任务，更新 tasklist.md
3. 遇到设计变更，同步更新 design.md

### 阶段五：测试验证

**验证清单**:
- [ ] 功能测试：验收标准全部通过
- [ ] 边界测试：异常场景正确处理
- [ ] 兼容测试：目标环境正常运行

### 阶段六：代码提交

```bash
# 检查变更
git status
git diff

# 提交代码
git add .
git commit -m "feat: {功能描述}"

# 推送远程
git push origin master
```

### 阶段七：文档更新

- 更新 tasklist.md 标记已完成任务
- 如有变更，更新 design.md
- 必要时更新 requirements.md

---

## 现有功能规范索引

| 功能 | 规范目录 | 状态 |
|------|----------|------|
| 视频转录 | `docs/specs/video-transcription/` | 规划中 |
| Remotion 视频生成 | `docs/specs/remotion-video-generation/` | 规划中 |
| MCP 发布平台 | `docs/specs/mcp-publish-platform/` | 规划中 |
| LiteLLM 集成 | `docs/specs/litellm-integration/` | 规划中 |
| 深色模式切换 | `docs/specs/dark-mode-toggle/` | 规划中 |
| 自动开发服务器 | `docs/specs/auto-dev-server/` | 规划中 |

---

## 快速启动脚本

### Windows

创建 `start-dev.bat`：
```batch
@echo off
echo === 拉取远程代码 ===
git pull origin master

echo === 启动后端服务 ===
start cmd /k "cd server && node simple-server.js"

echo === 启动前端服务 ===
start cmd /k "npm run dev"

echo === 开发环境已启动 ===
pause
```

### Linux/Mac

创建 `start-dev.sh`：
```bash
#!/bin/bash
echo "=== 拉取远程代码 ==="
git pull origin master

echo "=== 启动后端服务 ==="
gnome-terminal -- bash -c "cd server && node simple-server.js; exec bash"

echo "=== 启动前端服务 ==="
gnome-terminal -- bash -c "npm run dev; exec bash"

echo "=== 开发环境已启动 ==="
```

---

## 服务地址

| 服务 | 地址 | 说明 |
|------|------|------|
| 前端 | http://localhost:5174 | React 开发服务器 |
| 后端 | http://localhost:5000 | Express API 服务器 |
| 健康检查 | http://localhost:5000/api/health | 服务状态检查 |

---

## 常见问题

### Q: 规范文档太长，如何快速上手？

**A**: 使用"渐进式"方法：
1. **第一遍**：只看需求文档的验收标准
2. **第二遍**：开发时参考设计文档的模块划分
3. **第三遍**：完成后对照任务清单确认

### Q: 开发中发现设计不合理怎么办？

**A**: 遵循"先记录，后调整"原则：
1. 在代码注释中标记 `// TODO: 设计变更`
2. 完成功能后，统一更新 design.md
3. 提交时说明设计变更原因

### Q: 任务清单如何保持更新？

**A**: 每日开发结束时：
1. 标记已完成的任务
2. 添加新发现的任务
3. 调整剩余任务的优先级

---

**文档维护者**: AI内容创作系统开发团队
**最后更新**: 2026-02-16
